# Kapitanov Horizon Quantization — Detection pipeline

This repository contains a minimal pipeline to fetch LIGO strain data, extract ringdown windows, compute FFT/PSD, and search for discrete-frequency combs as described in the Kapitanov quantization proposal.

Quickstart

1. Create a virtualenv and install dependencies:

```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
# Kapitanov Horizon Quantization — Detection pipeline

This repository implements a minimal, reproducible pipeline for the Kapitanov horizon-quantization comb search on LIGO open data. It fetches strain data around an event, extracts a short ringdown window and a multi-second background window, computes FFT/Welch PSD estimates, and evaluates a simple harmonic-comb detection statistic.

Contents
- `download_gwpy.py` — main CLI and analysis functions (data fetch, PSD, detection, bootstrap, stacking, masking)
- `requirements.txt` — Python dependencies
- `results/` — local directory where per-event JSON outputs, bootstraps and plots are written (this directory is git-ignored)
- `results/plots/` — diagnostic PNGs (generated by the script)

Quickstart

1) Create and activate a Python virtual environment, then install requirements:

```bash
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

2) Run a single-event exact-mode analysis (PHASE 2: 10–100 ms ringdown, 1–5 s background, Tukey α=0.25):

```bash
python download_gwpy.py --event GW200129_065458 --detector H1 --exact
```

3) Run validation (detector confirmation, time-window robustness, k-scan, pre-merger checks):

```bash
python download_gwpy.py --event GW200129_065458 --validate
```

4) Compute empirical p-values (bootstrap) for many events:

```bash
python download_gwpy.py --do-bootstrap --events GW200129_065458,GW200224_222234 --kvalue 2 --bootstrap-iters 2000
```

5) Run a masked re-analysis to exclude known instrumental line harmonics (±5 Hz by default):

```bash
python download_gwpy.py --do-bootstrap --events GW200129_065458 --kvalue 2 --bootstrap-iters 2000 --mask-lines --mask-width 5.0
```

6) Stack mass-normalized PSDs across events and bootstrap the stacked statistic:

```bash
python download_gwpy.py --do-stack --events GW200129_065458,GW200224_222234 --kvalue 2 --stack-iters 1000
```

Outputs
- Per-event JSON results are written to `results/{event}_{detector}_result.json`.
- Bootstrap/null distributions are written to `results/{event}_{detector}_bootstrap_k{k}.json`.
- A CSV summary `results/k2_summary.csv` and diagnostic plots are saved under `results/plots/`.

Caveats & recommendations
- This code is experimental and intended for exploration; do not use results as final significance claims without cross-checks.
- The script uses empirical background resampling (bootstrap) to estimate p-values. Background fetch failures may trigger fallbacks; the code now avoids zero-padding for per-event bootstrap if the background interval is long enough, but stacking can fall back to safe defaults if necessary. The CSV summary contains explicit caveats when fallbacks were used.
- Always inspect diagnostic plots (PSD, spectrogram, harmonic SNRs) and mask known instrument lines before making claims.

Development
- Please see `CONTRIBUTING.md` for contribution guidelines.
- This repository is released under the MIT License (see `LICENSE`).

Contact
- Open an issue or a PR on the GitHub repository for questions or suggested improvements.

Acknowledgements
- Uses `gwpy` and `gwosc` to access LIGO Open Science Center data.

--
Minimal, reproducible research code. Use responsibly.
